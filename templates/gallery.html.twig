{% extends "base.html.twig" %}

{% block title %}Галерея - {{ site_name }}{% endblock %}

{% block content %}
  <!-- Gallery Section -->
  <section id="gallery" class="gallery-section">
    <!-- Category Filter -->
    {% if categories is not empty %}
      <div class="container d-flex justify-content-center mb-4 pt-2">
        <div class="btn-group" role="group">
          <a 
            href="{{ base }}gallery" 
            class="btn btn-outline-secondary {% if not category %}active{% endif %}"
          >
            Усі роботи
          </a>
          {% for cat in categories %}
            <a 
              href="{{ base }}gallery?category={{ cat.category|url_encode }}" 
              class="btn btn-outline-secondary {% if category == cat.category %}active{% endif %}"
            >
              {{ cat.category|sanitize }}
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- Artworks Grid -->
    {% if works is empty %}
      <div class="container py-5">
        <div class="alert alert-info text-center">
          Роботи не знайдені
        </div>
      </div>
    {% else %}
      {% for work in works %}
        <div class="artwork-container" data-aos="fade-up">
          <div class="artwork-image">
            <img 
              src="{{ work.image|sanitize }}" 
              alt="{{ work.title|sanitize }}" 
              loading="lazy"
            >
          </div>
          <div class="artwork-caption">
            <h2 class="artwork-title">{{ work.title|sanitize }}</h2>
            <p class="artwork-description">
              {{ work.description|sanitize|nl2br }}
            </p>
          </div>
        </div>
      {% endfor %}

      <!-- Pagination -->
      {% if total_pages > 1 %}
        <div class="container d-flex justify-content-center my-5">
          <nav aria-label="Навігація по сторінках">
            <ul class="pagination">
              {% if has_prev %}
                <li class="page-item">
                  <a class="page-link" href="{{ base }}gallery?page={{ current_page - 1 }}{% if category %}&category={{ category|url_encode }}{% endif %}">
                    ← Попередня
                  </a>
                </li>
              {% else %}
                <li class="page-item disabled">
                  <span class="page-link">← Попередня</span>
                </li>
              {% endif %}

              {% for page_num in 1..total_pages %}
                {% if page_num == current_page %}
                  <li class="page-item active">
                    <span class="page-link">
                      {{ page_num }}
                      <span class="visually-hidden">(поточна сторінка)</span>
                    </span>
                  </li>
                {% elseif (page_num == 1 or page_num == total_pages) or (page_num >= current_page - 1 and page_num <= current_page + 1) %}
                  <li class="page-item">
                    <a class="page-link" href="{{ base }}gallery?page={{ page_num }}{% if category %}&category={{ category|url_encode }}{% endif %}">
                      {{ page_num }}
                    </a>
                  </li>
                {% elseif page_num == 2 and current_page > 3 %}
                  <li class="page-item disabled">
                    <span class="page-link">…</span>
                  </li>
                {% elseif page_num == total_pages - 1 and current_page < total_pages - 2 %}
                  <li class="page-item disabled">
                    <span class="page-link">…</span>
                  </li>
                {% endif %}
              {% endfor %}

              {% if has_next %}
                <li class="page-item">
                  <a class="page-link" href="{{ base }}gallery?page={{ current_page + 1 }}{% if category %}&category={{ category|url_encode }}{% endif %}">
                    Наступна →
                  </a>
                </li>
              {% else %}
                <li class="page-item disabled">
                  <span class="page-link">Наступна →</span>
                </li>
              {% endif %}
            </ul>
          </nav>
        </div>
      {% endif %}
    {% endif %}
  </section>

  <!-- Footer -->
  {% include 'footer.html.twig' %}
{% endblock %}
